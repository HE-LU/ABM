apply plugin: "java"
apply plugin: "idea"

repositories {
	jcenter()
	maven {	url "http://my.repository.url"}
	maven {	url "http://maven.restlet.com"}
}

dependencies {
	compile fileTree(dir: 'libs', include: ['*.jar'])
	compile 'com.intellij:openapi:7.0.3'

	compile 'com.miglayout:miglayout-swing:4.2'
	compile 'org.swinglabs:swingx:1.6.1'
	compile 'org.restlet.jse:org.restlet:2.2.2'
	compile 'com.google.code.gson:gson:1.7.2'
}

defaultTasks 'makeJar'


jar {
	baseName = 'gs-gradle'
	version = '0.1.0'
}

idea.project.ipr {
	beforeMerged {project -> project.modulePaths.clear()}
}

idea.module.iml {
	withXml {it.node.@type = "PLUGIN_MODULE"}
}

task setup {
	description = "crete .idea based project structure"
	dependsOn ideaModule, ideaProject
	doLast {
		copy {
			from '.'
			into '.idea/'
			include '*.ipr'
			rename {"modules.xml"}}
		project.delete "${project.name}.ipr"
	}
}

task copyDependencies(type: Copy) {
	from configurations.compile
	into 'build/dependencies'
}


task makeJar(type: Jar, dependsOn: classes) {
	outputs.upToDateWhen {false}
	dependsOn setup
	dependsOn copyDependencies

	from zipTree('./build/dependencies/org.restlet-2.2.2.jar')
	from sourceSets.main.output

	doLast {
		copy {
			from './build/libs'
			into './'
			include '*.jar'
			rename {"ABM.jar"}
		}
		copy {
			from './build/libs'
			into './../.IdeaIC13/system/plugins-sandbox/plugins'
			include '*.jar'
			rename {"ABM.jar"}
		}
		delete "./build/libs/ABM.jar"
	}
}

task wrapper(type: Wrapper) {
	gradleVersion = '1.8'
}